<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Escape the Deadline â€“ Scores</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/svg+xml" href="../favicon.svg" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #f3f3f3;
    --card: #ffffff;
    --border: #e1e5ea;
    --text: #111;
    --muted: #6b7280;
    --accent: #f59e0b;
  }

  body {
    margin: 0;
    padding: 40px 16px 80px;
    background: var(--bg);
    font-family: "Urbanist", system-ui, -apple-system, sans-serif;
    color: var(--text);
  }

  .header {
    text-align: center;
    margin-bottom: 40px;
  }

  .brand img {
    height: 42px;
    margin-bottom: 12px;
  }

  h1 {
    font-size: 40px;
    margin: 0;
    letter-spacing: .06em;
  }

  h2 {
    font-size: 34px;
    font-weight: 400;
    margin: 0;
    letter-spacing: .06em;
  }

  .subtitle {
    margin-top: 10px;
    color: var(--muted);
  }

  .card {
    max-width: 1100px;
    margin: 0 auto;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1000px;
  }

  thead {
    background: #fafafa;
  }

  th, td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    text-align: left;
    white-space: nowrap;
  }

  th {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: .05em;
    color: var(--muted);
  }

  tbody tr:hover {
    background: #fafafa;
  }

  .rank {
    width: 40px;
    font-weight: 600;
  }

  .name {
    font-weight: 600;
  }

  .num {
    text-align: right;
    font-variant-numeric: tabular-nums;
  }

  .combo {
    color: var(--accent);
    font-weight: 600;
  }

  .muted {
    color: var(--muted);
  }

  .badge {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 500;
    background: #e5e7eb;
  }

  .badge.discount {
    background: #dbeafe;
    color: #1e40af;
  }

  .badge.consultation {
    background: #dcfce7;
    color: #166534;
  }

  @media (max-width: 700px) {
    h1 { font-size: 28px; }
    th, td { padding: 10px 8px; }
  }

  /* === PASSWORD OVERLAY === */
#pw-overlay {
  position: fixed;
  inset: 0;
  padding: 24px;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  box-sizing: border-box;
}

#pw-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 32px;
  width: 100%;
  max-width: 360px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,.1);
}

#pw-card img {
  height: 40px;
  margin-bottom: 16px;
}

#pw-card h3 {
  margin: 0 0 16px;
  font-weight: 500;
}

#pw-card input {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  font-family: inherit;
  font-size: 15px;
  margin-bottom: 12px;
}

#pw-card button {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: none;
  background: #111;
  color: #fff;
  font-family: inherit;
  font-size: 15px;
  cursor: pointer;
}

#pw-error {
  display: none;
  margin-top: 10px;
  color: #dc2626;
  font-size: 14px;
}

</style>
</head>
<body>
  <!-- PASSWORD OVERLAY -->
<div id="pw-overlay">
  <div id="pw-card">
    <img src="https://fun.crackwits.com/Assets/CW-Logo.svg" alt="Crackwits" />
    <h3>Admin Leaderboard Access</h3>
    <input
      type="password"
      id="pw-input"
      placeholder="Enter password"
      autocomplete="off"
    />
    <button onclick="unlockPage()">Enter</button>
    <div id="pw-error">Incorrect password</div>
  </div>
</div>
<!-- END PASSWORD -->

<div class="header">
  <div class="brand">
    <img
      src="https://fun.crackwits.com/Assets/CW-Logo.svg"
      alt="Crackwits"
    />
  </div>
  <h2>ESCAPE THE DEADLINE</h2>
  <div class="subtitle">Leaderboard & Entries</div>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th class="num">Distance</th>
        <th class="num">Combo</th>
        <th class="num">Elf</th>
        <th class="num">Grinch</th>
        <th>Email</th>
        <th>Prize</th>
        <th class="muted">Created</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr>
        <td colspan="9" class="muted">Loadingâ€¦</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
  /* SHA-256 hash of your password */
  const PW_HASH =
    "cb1302383832b8fe27064501074f5a8e8d44357f0ec94a209f92ace5375cf340";

  async function sha256(text) {
    const buf = new TextEncoder().encode(text);
    const hash = await crypto.subtle.digest("SHA-256", buf);
    return Array.from(new Uint8Array(hash))
      .map(b => b.toString(16).padStart(2, "0"))
      .join("");
  }

  async function unlockPage() {
    const input = document.getElementById("pw-input");
    const error = document.getElementById("pw-error");
    const hash = await sha256(input.value);

    if (hash === PW_HASH) {
      document.getElementById("pw-overlay").style.display = "none";
    } else {
      error.style.display = "block";
      input.value = "";
    }
  }
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    orderBy,
    query
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyArYZSVQdexBaE3mKNSOBC3M7ldD19LESo",
    authDomain: "cw-game-a42eb.firebaseapp.com",
    projectId: "cw-game-a42eb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  const q = query(
    collection(db, "scores"),
    orderBy("created_at", "desc")
  );

  const snap = await getDocs(q);

  let rank = 1;

  snap.forEach(doc => {
    const d = doc.data();

    // Handle all timestamp formats safely
    let created = "â€”";
    if (d.created_at) {
      if (typeof d.created_at === "string") {
        created = new Date(d.created_at).toLocaleString();
      } else if (d.created_at.toDate) {
        created = d.created_at.toDate().toLocaleString();
      } else if (d.created_at.seconds) {
        created = new Date(d.created_at.seconds * 1000).toLocaleString();
      }
    }

    const prize = d.prize_selection
      ? `<span class="badge ${d.prize_selection}">${d.prize_selection}</span>`
      : "â€”";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="rank">${rank++}</td>
      <td class="name">${d.player_name ?? "â€”"}</td>
      <td class="num">${d.distance ?? 0}m</td>
      <td class="num combo">${d.max_combo ?? "â€”"}x</td>
      <td class="num">ðŸŽ„ ${d.elf_score ?? 0}</td>
      <td class="num">ðŸ˜ˆ ${d.grinch_score ?? 0}</td>
      <td class="muted">${d.email ?? "â€”"}</td>
      <td>${prize}</td>
      <td class="muted">${created}</td>
    `;

    tbody.appendChild(tr);
  });
</script>

</body>
</html>
